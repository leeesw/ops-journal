# /etc/systemd/system/flagship-seoulmake.service
[Unit]
Description=Puma (Flagship Seoulmake)
After=network.target

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/home/ubuntu/flagship-seoulmake
EnvironmentFile=/etc/flagship-seoulmake.env

# rbenv 경로/초기화 (PATH 보정 + rbenv init)
Environment=RBENV_ROOT=/home/ubuntu/.rbenv
Environment=PATH=/home/ubuntu/.rbenv/shims:/home/ubuntu/.rbenv/bin:/usr/local/bin:/usr/bin:/bin

# bash -lc 로 로그인셸 초기화 + rbenv init + puma 기동
ExecStart=/bin/bash -lc 'eval "$(rbenv init -)"; bundle exec puma -C config/puma.rb -b tcp://0.0.0.0:3000'

Restart=always
RestartSec=3
TimeoutSec=300

[Install]
WantedBy=multi-user.target

# /etc/systemd/system/flagship-seoulmake.service.d/override.conf
[Service]
# (선택) 추가 파일이 있다면 읽고, 없어도 에러내지 않게 - 접두
EnvironmentFile=-/etc/default/flagship-seoulmake

# ExecStart 재정의: rbenv init 포함(번들/루비 버전 해석 안정)
ExecStart=
ExecStart=/bin/bash -lc 'eval "$(rbenv init -)"; exec bundle exec puma -C config/puma.rb -b tcp://0.0.0.0:3000'

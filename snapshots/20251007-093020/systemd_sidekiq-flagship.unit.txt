# /etc/systemd/system/sidekiq-flagship@.service
[Unit]
Description=Sidekiq %i (Flagship Seoulmake)
After=network.target redis.service
Wants=network-online.target

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/home/ubuntu/flagship-seoulmake
EnvironmentFile=/etc/flagship-seoulmake.env
EnvironmentFile=-/etc/default/sidekiq-flagship@%i
Environment=RBENV_ROOT=/home/ubuntu/.rbenv
Environment=PATH=/home/ubuntu/.rbenv/shims:/home/ubuntu/.rbenv/bin:/usr/local/bin:/usr/bin:/bin
ExecStart=/bin/bash -lc '\
  eval "$(rbenv init -)"; \
  QARGS=""; for q in ${QUEUES//,/ } ; do QARGS="$QARGS -q $q"; done; \
  exec bundle exec sidekiq \
    -e ${RAILS_ENV:-production} \
    -c ${CONCURRENCY:-5} \
    -g sidekiq-flagship@%i \
    $QARGS \
'
Restart=always
RestartSec=3
TimeoutSec=300

[Install]
WantedBy=multi-user.target
